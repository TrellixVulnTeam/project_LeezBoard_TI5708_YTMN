<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>IMGLIB: IMG_ycbcr422pl_to_rgb565</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<table width=100%>
<tr>
  <td bgcolor="black" width="1"><a href="http://www.ti.com"><img border=0 src="tilogo.gif"></a></td>
  <td bgcolor="red"><img src="titagline.gif"></td>
</tr>
</table>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>IMG_ycbcr422pl_to_rgb565</h1><hr><a name="_details"></a><h2>Detailed Description</h2>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___i_m_g__ycbcr422pl__to__rgb565.html#g3c249735a89f8bfc5ef45a49c281066a">IMG_ycbcr422pl_to_rgb565</a> (const short coeff[5], const unsigned char *restrict y_data, const unsigned char *restrict cb_data, const unsigned char *restrict cr_data, unsigned short *restrict rgb_data, unsigned num_pixels)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="g3c249735a89f8bfc5ef45a49c281066a"></a><!-- doxytag: member="c66/IMG_ycbcr422pl_to_rgb565.h::IMG_ycbcr422pl_to_rgb565" ref="g3c249735a89f8bfc5ef45a49c281066a" args="(const short coeff[5], const unsigned char *restrict y_data, const unsigned char *restrict cb_data, const unsigned char *restrict cr_data, unsigned short *restrict rgb_data, unsigned num_pixels)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void IMG_ycbcr422pl_to_rgb565           </td>
          <td>(</td>
          <td class="paramtype">const short&nbsp;</td>
          <td class="paramname"> <em>coeff</em>[5], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *restrict&nbsp;</td>
          <td class="paramname"> <em>y_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *restrict&nbsp;</td>
          <td class="paramname"> <em>cb_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *restrict&nbsp;</td>
          <td class="paramname"> <em>cr_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short *restrict&nbsp;</td>
          <td class="paramname"> <em>rgb_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>num_pixels</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Description:</b></dt><dd>This kernel performs Y'CbCr to RGB conversion. From the Color FAQ, <a href="http://home.inforamp.net/~poynton/ColorFAQ.html:">http://home.inforamp.net/~poynton/ColorFAQ.html:</a> </dd></dl>
<dl class="user" compact><dt><b></b></dt><dd>Various scale factors are applied to (B'-Y') and (R'-Y') for different applications. The Y'PbPr scale factors are optimized for component analog video. The Y'CbCr scaling is appropriate for component digital video, JPEG and MPEG. Kodak's PhotoYCC(tm) uses scale factors optimized for the gamut of film colors. Y'UV scaling is appropriate as an intermediate step in the formation of composite NTSC or PAL video signals, but is not appropriate when the components are keps separate. Y'UV nomenclature is now used rather loosely, and it sometimes denotes any scaling of (B'-Y') and (R'-Y'). Y'IQ coding is obsolete. </dd></dl>
<dl class="user" compact><dt><b></b></dt><dd>This code can perform various flavors of Y'CbCr to RGB conversion as long as the offsets on Y, Cb, and Cr are -16, -128, and -128, respectively, and the coefficients match the pattern shown. </dd></dl>
<dl class="user" compact><dt><b></b></dt><dd>The kernel implements the following matrix form, which involves 5 unique coefficients: <div class="fragment"><pre class="fragment">
                                                                          
          [ coeff[0] 0.0000   coeff[1] ]   [ Y' -  16 ]     [ R']         
          [ coeff[0] coeff[2] coeff[3] ] * [ Cb - 128 ]  =  [ G']         
          [ coeff[0] coeff[4] 0.0000   ]   [ Cr - 128 ]     [ B']         
   </pre></div></dd></dl>
Below are some common coefficient sets, along with the matrix equation that they correspond to. Coefficients are in signed Q13 notation, which gives a suitable balance between precision and range. <div class="fragment"><pre class="fragment">
                                                                          
      1.  Y'CbCr -&gt; RGB conversion with RGB levels that correspond to     
          the 219-level range of Y'.  Expected ranges are [16..235] for   
          Y' and [16..240] for Cb and Cr.                                 
                                                                          
          coeff[] = { 0x2000, 0x2BDD, -0x0AC5, -0x1658, 0x3770 };         
                                                                          
          [ 1.0000    0.0000    1.3707 ]   [ Y' -  16 ]     [ R']         
          [ 1.0000   -0.3365   -0.6982 ] * [ Cb - 128 ]  =  [ G']         
          [ 1.0000    1.7324    0.0000 ]   [ Cr - 128 ]     [ B']         
                                                                          
      2.  Y'CbCr -&gt; RGB conversion with the 219-level range of Y'         
          expanded to fill the full RGB dynamic range.  (The matrix       
          has been scaled by 255/219.)  Expected ranges are [16..235]     
          for Y' and [16..240] for Cb and Cr.                             
                                                                          
          coeff[] = { 0x2543, 0x3313, -0x0C8A, -0x1A04, 0x408D };         
                                                                          
          [ 1.1644    0.0000    1.5960 ]   [ Y' -  16 ]     [ R']         
          [ 1.1644   -0.3918   -0.8130 ] * [ Cb - 128 ]  =  [ G']         
          [ 1.1644    2.0172    0.0000 ]   [ Cr - 128 ]     [ B']         
                                                                          
      3.  Y'CbCr -&gt; BGR conversion with RGB levels that correspond to     
          the 219-level range of Y'.  This is equivalent to #1 above,     
          except that the R, G, and B output order in the packed          
          pixels is reversed.  Note:  The 'cr_data' and 'cb_data'         
          input arguments must be exchanged for this example as           
          indicated under USAGE above.                                    
                                                                          
          coeff[] = { 0x2000, 0x3770, -0x1658, -0x0AC5, 0x2BDD };         
                                                                          
          [ 1.0000    0.0000    1.7324 ]   [ Y' -  16 ]     [ B']         
          [ 1.0000   -0.6982   -0.3365 ] * [ Cr - 128 ]  =  [ G']         
          [ 1.0000    1.3707    0.0000 ]   [ Cb - 128 ]     [ R']         
                                                                          
      4.  Y'CbCr -&gt; BGR conversion with the 219-level range of Y'         
          expanded to fill the full RGB dynamic range.  This is           
          equivalent to #2 above, except that the R, G, and B output      
          order in the packed pixels is reversed.  Note:  The             
          'cr_data' and 'cb_data' input arguments must be exchanged       
          for this example as indicated under USAGE above.                
                                                                          
          coeff[] = { 0x2000, 0x408D, -0x1A04, -0x0C8A, 0x3313 };         
                                                                          
          [ 1.0000    0.0000    2.0172 ]   [ Y' -  16 ]     [ B']         
          [ 1.0000   -0.8130   -0.3918 ] * [ Cr - 128 ]  =  [ G']         
          [ 1.0000    1.5960    0.0000 ]   [ Cb - 128 ]     [ R']         
   </pre></div><p>
Other scalings of the color differences (B'-Y') and (R'-Y') (sometimes incorrectly referred to as U and V) are supported, as long as the color differences are unsigned values centered around 128 rather than signed values centered around 0, as noted above. <dl class="user" compact><dt><b></b></dt><dd>In addition to performing plain color-space conversion, color saturation can be adjusted by scaling coeff[1] through coeff[4]. Similarly, brightness can be adjusted by scaling coeff[0]. General hue adjustment can not be performed, however, due to the two zeros hard-coded in the matrix.</dd></dl>
<dl class="user" compact><dt><b>Usage:</b></dt><dd>This function takes the following parameters: </dd></dl>
<dl class="user" compact><dt><b></b></dt><dd></dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>coeff</em>&nbsp;</td><td>Matrix coefficients. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>y_data</em>&nbsp;</td><td>Luminence data (Y') </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cb_data</em>&nbsp;</td><td>Blue color-diff (B'-Y') </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cr_data</em>&nbsp;</td><td>Red color-diff (R'-Y') </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rgb_data</em>&nbsp;</td><td>RGB 5:6:5 packed pixel out. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>num_pixels</em>&nbsp;</td><td>Number of luma pixels to process </td></tr>
  </table>
</dl>
<dl class="user" compact><dt><b></b></dt><dd>The 'coeff[]' array contains the color-space-conversion matrix coefficients. The 'y_data', 'cb_data' and 'cr_data' pointers point to the separate input image planes. The 'rgb_data' pointer points to the output image buffer. See below for alignment constraints on these buffers. </dd></dl>
<dl class="user" compact><dt><b></b></dt><dd>The kernel is designed to process arbitrary amounts of 4:2:2 image data, although 4:2:0 image data may be processed as well. For 4:2:2 input data, the 'y_data', 'cb_data' and 'cr_data' arrays may hold an arbitrary amount of image data, including multiple scan lines of image data. </dd></dl>
<dl class="user" compact><dt><b></b></dt><dd>For 4:2:0 input data, only a single scan-line (or portion thereof) may be processed at a time. This is achieved by calling the function twice using the same row data for 'cr_data' and 'cb_data', and providing new row data for 'y_data'. This is numerically equivalent to replicating the Cr and Cb pixels vertically. </dd></dl>
<dl class="user" compact><dt><b></b></dt><dd>The coefficients in the coeff array must be in signed Q13 form. These coefficients correspond to the following matrix equation: <div class="fragment"><pre class="fragment">
                                                                          
          [ coeff[0] 0.0000   coeff[1] ]   [ Y' -  16 ]     [ R']         
          [ coeff[0] coeff[2] coeff[3] ] * [ Cb - 128 ]  =  [ G']         
          [ coeff[0] coeff[4] 0.0000   ]   [ Cr - 128 ]     [ B']         
   </pre></div></dd></dl>
The output from this kernel is 16-bit RGB in 5:6:5 format. The RGB components are packed into halfwords as shown below. <div class="fragment"><pre class="fragment">
                                                                          
                      15      11 10       5 4        0                     
                    +----------+----------+----------+                    
                    |   Red    |  Green   |   Blue   |                    
                    +----------+----------+----------+                    
   </pre></div><p>
This kernel can also return the red, green, and blue values in the opposite order if a particular application requires it. This is achieved by exchanging the 'cb_data' and 'cr_data' arguments when calling the function, and by reversing the order of coefficients in coeff[1] through coeff[4]. This essentially implements the following matrix multiply: <div class="fragment"><pre class="fragment">
                                                                          
          [ coeff[0] 0.0000   coeff[4] ]   [ Y' -  16 ]     [ B']         
          [ coeff[0] coeff[3] coeff[2] ] * [ Cr - 128 ]  =  [ G']         
          [ coeff[0] coeff[1] 0.0000   ]   [ Cb - 128 ]     [ R']         
   </pre></div><p>
The reversed RGB ordering output by this mode is as follows: <div class="fragment"><pre class="fragment">
                                                                          
                      15      11 10       5 4        0                     
                    +----------+----------+----------+                    
                    |   Blue   |  Green   |   Red    |                    
                    +----------+----------+----------+                    
   </pre></div><p>
<dl class="user" compact><dt><b>Assumptions:</b></dt><dd><ul>
<li>The number of luma samples must to be a multiple of 8</li><li>The input Y array should be 32-bit aligned</li><li>The input Cr and Cb arrays should be 16-bit aligned</li><li>The output image should be 32-bit aligned</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Implementation Notes:</b></dt><dd><ul>
<li>This code is fully interruptible and fully reentrant</li><li>This code is compatible with C66x processors (though not optimized)</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Benchmarks:</b></dt><dd>See IMGLIB_Test_Report.html for cycle and memory information. </dd></dl>

</div>
</div><p>
<hr size="1"><small>
Copyright  2012, Texas Instruments Incorporated</small>
</body>
</html>
